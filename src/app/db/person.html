
<p-dataTable [value]="tableValues" selectionMode="single" [(selection)]="selectedRecord" (onRowSelect)="onRowSelect($event)" [paginator]="true" rows="15" [responsive]="true" *ngIf="dataLoaded">
    <p-header>{{ subTitle }} <br /> {{summary}}</p-header>

    <p-column field="web_domain" header="Web Domain" [sortable]="true"></p-column>
    
    <p-column field="names" header="Names" [sortable]="true">
        <ng-template let-col let-names="rowData.names" pTemplate="body">
            <ul><li *ngFor="let name of names">
                {{ name.prefix }} {{ name.first }} {{ name.middle }} {{ name.last }} {{ name.suffix }}
            </li></ul>
        </ng-template>
    </p-column>
    
    <p-column field="gender" header="Gender" [sortable]="true">
        <ng-template let-col let-g="rowData.gender" pTemplate="body">
            {{ getLabel(genders, 'value', g) }}
        </ng-template>    
        
    </p-column>
    
    <p-footer>
        <div class="ui-helper-clearfix" style="width:100%">
            <button *ngIf="!selectedRecord" type="button" pButton icon="fa-plus" style="float:left" (click)="showDialogToAdd()" label="Add"></button>
            <button *ngIf="selectedRecord" type="button" pButton icon="fa-plus" style="float:left" (click)="showDialogToAdd()" label="Clone"></button>            
        </div>
    </p-footer>
</p-dataTable>

<div *ngIf="message" class="ui-message ui-corner-all ui-messages-success">
    {{message}}
</div>

<div *ngIf="errorMessage" class="ui-message ui-messages-error ui-corner-all">
    Can not save. Please check following: <ul>
        <li *ngFor="let error of keysOfObject(errorMessage)">
            {{error}} : 
            <span *ngIf="isVariableObject(errorMessage[error])">
                <ul>
                    <li  *ngFor="let subError of keysOfObject(errorMessage[error])">
                        {{subError}} : {{errorMessage[error][subError] | json}}
                    </li>
                </ul>
            </span>
            <span *ngIf="!isVariableObject(errorMessage[error])">
                {{errorMessage[error]}}
            </span>
        </li>
    </ul>
</div>


<p-dialog header="{{title}}" [(visible)]="displayDialog" [responsive]="true" showEffect="fade" [modal]="true" [responsive]="true" [contentStyle]="{'overflow':'auto','max-height':'500px'}" >

    <form [formGroup]="recordForm" novalidate (ngSubmit)="save(recordForm.value)">

        <div class="ui-grid ui-grid-responsive ui-fluid">

            <div class="ui-grid-row lns_sub_fields_border">
                <div class="ui-grid-col-12">
                    <label for="web_domain" style="font-weight: bolder;">Web Domain *</label>

                    <input pInputText type="text" id="web_domain" formControlName="web_domain" />

                    <div class="ui-message ui-messages-error ui-corner-all" *ngIf="recordForm.controls.web_domain.errors && recordForm.controls.web_domain.errors.required"
                    >
                        Web domain is required
                    </div>
                </div>
            </div>

            <div class="ui-grid-row lns_sub_fields_border">
                <div class="ui-grid-col-12">

                    <label for="names_id" style="font-weight: bolder;">Names *</label>

                    <div formArrayName="names" id="names_id">

                        <p-panel *ngFor=" let name of recordForm.controls.names.controls; let namesIndex=index; ">

                        <p-header>
                            <div class="ui-helper-clearfix">
                                <span class="ui-panel-title" style="font-size:16px;display:inline-block;margin-top:2px">Name {{namesIndex + 1}}</span>
                                
                                <span 
                                    style="float:right"
                                    *ngIf="recordForm.controls.names.controls.length > 1"
                                    (click)="recordForm.get('names').removeAt(namesIndex)"
                                ><i class="fa fa-close"></i></span>
                            </div>
                        </p-header>
                            
                            <div [formGroupName]="namesIndex" >

                                <div class="ui-grid-row lns_sub_fields_border">
                                    <div class="ui-grid-col-12"> 

                                        <label for="prefix_id" style="font-weight: bolder;">Prefix</label>
                                        <input pInputText id="prefix_id" formControlName="prefix" />


                                        <div class="ui-message ui-messages-error ui-corner-all" 
                                            *ngIf="recordForm.controls.names.controls[namesIndex].controls.prefix.errors 
                                            &&  recordForm.controls.names.controls[namesIndex].controls.prefix.errors.pattern"
                                        >
                                            Prefix format is not correct
                                        </div>

                                    </div>
                                </div>
                            
                                <div class="ui-grid-row lns_sub_fields_border">
                                    <div class="ui-grid-col-12">
                                        <label for="first_id" style="font-weight: bolder;">First *</label>
                                        <input pInputText id="first_id" formControlName="first" />
                                        
                                        <div class="ui-message ui-messages-error ui-corner-all" 
                                            *ngIf="recordForm.controls.names.controls[namesIndex].controls.first.errors 
                                            && recordForm.controls.names.controls[namesIndex].controls.first.errors.required"
                                        >
                                            First name is required
                                        </div>

                                         <div class="ui-message ui-messages-error ui-corner-all" 
                                            *ngIf="recordForm.controls.names.controls[namesIndex].controls.first.errors 
                                            && recordForm.controls.names.controls[namesIndex].controls.first.errors.pattern"
                                        >
                                            First name format is not correct
                                        </div>
                   
                                    </div>
                                </div>
                            
                                <div class="ui-grid-row lns_sub_fields_border">
                                    <div class="ui-grid-col-12">                            
                                        <label for="middle_id" style="font-weight: bolder;">Middle</label>
                                        <input pInputText id="middle_id" formControlName="middle" />

                                        <div class="ui-message ui-messages-error ui-corner-all" 
                                            *ngIf="recordForm.controls.names.controls[namesIndex].controls.middle.errors 
                                            && recordForm.controls.names.controls[namesIndex].controls.middle.errors.pattern"
                                        >
                                            Middle name format is not correct
                                        </div>

                                    </div>
                                </div>
                            
                                <div class="ui-grid-row lns_sub_fields_border">
                                    <div class="ui-grid-col-12">
                                        <label for="last_id" style="font-weight: bolder;">Last</label>
                                        <input pInputText id="last_id" formControlName="last" />


                                        <div class="ui-message ui-messages-error ui-corner-all" 
                                            *ngIf="recordForm.controls.names.controls[namesIndex].controls.last.errors 
                                            && recordForm.controls.names.controls[namesIndex].controls.last.errors.pattern"
                                        >
                                            Last name format is not correct
                                        </div>

                                    </div>
                                </div>

                                <div class="ui-grid-row lns_sub_fields_border">
                                    <div class="ui-grid-col-12">
                                        <label for="suffix_id" style="font-weight: bolder;">Suffix</label>
                                        <input pInputText id="suffix_id" formControlName="suffix" />

                                        <div class="ui-message ui-messages-error ui-corner-all" 
                                            *ngIf="recordForm.controls.names.controls[namesIndex].controls.suffix.errors 
                                            && recordForm.controls.names.controls[namesIndex].controls.suffix.errors.pattern"
                                        >
                                            Suffix format is not correct
                                        </div>

                                    </div>
                                </div>

                            </div>

                        </p-panel>
                        
                    </div>

                    <button type="button" pButton icon="fa-add" label="Add Name" (click)="recordForm = addControlFromGroup(recordForm, 'names', initName())"></button>

                </div>
            </div> 

            <div class="ui-grid-row lns_sub_fields_border">
                <div class="ui-grid-col-12">
                    <label for="gender_id" style="font-weight: bolder;">Gender</label>
                    <p-listbox [options]="genders" id="gender_id"  formControlName="gender" ></p-listbox>
                </div>
            </div>

            <div class="ui-grid-row lns_sub_fields_border">
                <div class="ui-grid-col-12">
                    <label for="phone_numbers_id" style="font-weight: bolder;">Phone Numbers</label>
                    <div formArrayName="phone_numbers" id="phone_numbers_id">

                    <p-panel *ngFor="let phoneNumber of recordForm.controls.phone_numbers.controls; let phoneNumbersIndex=index; ">

                        <p-header>
                            <div class="ui-helper-clearfix">
                                <span class="ui-panel-title" style="font-size:16px;display:inline-block;margin-top:2px">Phone {{phoneNumbersIndex + 1}}</span>
                                
                                <span 
                                    style="float:right"
                                    *ngIf="recordForm.controls.phone_numbers.controls.length > 1"
                                    (click)="recordForm = removeControlFromGroup(recordForm, 'phone_numbers', phoneNumbersIndex)"
                                ><i class="fa fa-close"></i></span>
                            </div>
                        </p-header>
                            <p-listbox 
                                [options]="phoneNumberRecords" 
                                [formControlName]="phoneNumbersIndex" >
                            </p-listbox>
                        </p-panel>

                    </div>

                    <button type="button" pButton icon="fa-add" label="Add Phone" (click)="recordForm = addControlFromGroup(recordForm, 'phone_numbers', initPhone())"></button>

                </div>
            </div>


        </div>

        <p-footer>
            <div class="ui-dialog-buttonpane ui-helper-clearfix">
                <button type="button" pButton icon="fa-close" (click)="delete(recordForm.value)" label="Delete"></button>
                <button type="submit" pButton icon="fa-check" label="Save" [disabled]="!recordForm.valid" ></button>
            </div>
        </p-footer>

    </form>

    {{ recordForm.value | json }}
</p-dialog>